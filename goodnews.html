<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üì∞ Admin - Upload Good News</title>
<style>
body {font-family:'Poppins',sans-serif;background:#f2f4f7;padding:20px;color:#222;}
.container {max-width:420px;margin:30px auto;background:white;padding:20px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.1);}
input,textarea,button{width:100%;margin:8px 0;padding:10px;font-size:15px;border:1px solid #ccc;border-radius:8px;}
button{background:linear-gradient(145deg,#28a745,#1e7e34);color:#fff;font-weight:bold;cursor:pointer;}
button:hover{transform:scale(1.03);}
h2{text-align:center;color:#28a745;}
</style>
</head>
<body>
<h2>üì∞ Upload Today's Good News</h2>
<div class="container">
  <input type="text" id="newsTitle" placeholder="Enter news title" />
  <textarea id="newsDesc" rows="3" placeholder="Enter description..."></textarea>
  <input type="file" id="newsImage" accept="image/*" />
  <button id="uploadBtn">üì§ Publish News</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyDEQYPJFxQv8yFHptrTqoLHOn2L0PpgVhc",
  authDomain: "btcinvest-c0e25.firebaseapp.com",
  projectId: "btcinvest-c0e25",
  storageBucket: "btcinvest-c0e25.appspot.com",
  messagingSenderId: "204937458487",
  appId: "1:204937458487:web:cc27ece1249999279f60b2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

const titleEl = document.getElementById("newsTitle");
const descEl = document.getElementById("newsDesc");
const imgEl = document.getElementById("newsImage");
const uploadBtn = document.getElementById("uploadBtn");

uploadBtn.onclick = async () => {
  const title = titleEl.value.trim();
  const desc = descEl.value.trim();
  const file = imgEl.files[0];
  if (!title || !desc || !file) return alert("Please fill all fields!");

  uploadBtn.disabled = true;
  uploadBtn.innerText = "Uploading...";

  try {
    const fileRef = ref(storage, `goodnews/${Date.now()}_${file.name}`);
    await uploadBytes(fileRef, file);
    const imgURL = await getDownloadURL(fileRef);

    // Random starting view count (between 5k and 50k)
    const startViews = Math.floor(Math.random() * (50000 - 5000 + 1)) + 5000;

    await addDoc(collection(db, "good_news"), {
      title,
      desc,
      image: imgURL,
      views: startViews,
      likes: 0,
      createdAt: new Date().toISOString()
    });

    alert("‚úÖ News published successfully!");
    titleEl.value = "";
    descEl.value = "";
    imgEl.value = "";
  } catch (err) {
    alert("‚ùå Error: " + err.message);
  } finally {
    uploadBtn.disabled = false;
    uploadBtn.innerText = "üì§ Publish News";
  }
};
</script>
</body>
</html>
